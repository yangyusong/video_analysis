<script src="lib/zrender.min.js"></script>
<script src="asset/js/esl/esl.js"></script>
<script src="lib/echarts.all.js"></script>
<script>
require.config({
paths: {
echarts: 'lib/echart/'
}
});
</script>
<div data-id="2A851661" class="2A851661"><style>
    .chart {
        height: 200px;
        margin: 0px;
        padding: 0px;
    }
    h5 {
        margin-top: 30px;
        font-weight: bold;
    }
    h5:first-child {
        margin-top: 15px;
    }
</style>
    <div class="mui-content-padded ">
        <h5></h5>

        <div class="chart" id="tags_chart" _echarts_instance_="1568982951108" style="-webkit-tap-highlight-color: transparent; user-select: none; background-color: rgba(0, 0, 0, 0);"><div style="position: relative; overflow: hidden; width: 300px; height: 200px;"><div data-zr-dom-id="bg" class="zr-element" style="position: absolute; left: 0px; top: 0px; width: 300px; height: 200px; user-select: none;"></div><canvas width="300" height="200" data-zr-dom-id="0" class="zr-element" style="position: absolute; left: 0px; top: 0px; width: 300px; height: 200px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas><canvas width="300" height="200" data-zr-dom-id="1" class="zr-element" style="position: absolute; left: 0px; top: 0px; width: 300px; height: 200px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas><canvas width="300" height="200" data-zr-dom-id="_zrender_hover_" class="zr-element" style="position: absolute; left: 0px; top: 0px; width: 300px; height: 200px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas></div></div>
    </div>
    <script>

        var tagsData = {};

        var byId = function (id) {
            return document.getElementById(id);
        };
        function createRandomItemStyle() {
            return {
                normal: {
                    color: 'rgb(' + [
                        Math.round(Math.random() * 160),
                        Math.round(Math.random() * 160),
                        Math.round(Math.random() * 160)
                    ].join(',') + ')'
                }
            };
        }
        var getOptionTags = function (datas) {
//            console.log("geto");
//            console.log(datas);

            var tags = [];
            for(var i in datas.tributes)
            {
                tags.push({
                    name: datas.tributes[i],
                    value: 1486,
                    itemStyle: createRandomItemStyle()
                });
            }
            var option = {
                title: {
                    text: '标签',
                    link: 'http://'
                },
                tooltip: {
                    show: true
                },
                series: [{
                    name: '标签',
                    type: 'wordCloud',
                    size: ['80%', '80%'],
                    textRotation : [0, 45, 90, -45],
                    textPadding: 0,
                    autoSize: {
                        enable: true,
                        minSize: 14
                    },
                    data: tags
                }]
            };

            return option;
        };

        var tags_chart = echarts.init(byId('tags_chart'));

        function getDataTags(){
//            console.log("getDataTags");
            if(tagsHandler)
            {
                clearTimeout(tagsHandler);
            }
//            var _id = localStorage.getItem("_id");
//            if(_.size(tagsData) == 0 || tagsData._id != _id)
            if(true)
            {
                client.get(client.devHost + client.exist, {}, function(datas){
//                    console.log(datas);
                    if(_.size(datas) > 0)
                    {
                        tagsData = datas;
                        var op = getOptionTags(datas);
                        tags_chart.setOption(op);
//                datas = JSON.parse(datas);
                    }
                    tagsHandler = setTimeout(function(){
                        getDataTags();
                    }, 2000);

                });
            }
            else{
                tagsHandler = setTimeout(function(){
                    getDataTags();
                }, 300);
            }

        }

        var tagsHandler = setTimeout(function(){
            getDataTags();
        }, 300);

        byId("tags_chart").addEventListener('tap', function () {
            var url = this.getAttribute('data-url');
            if (window.plus) {
                plus.runtime.openURL(url);
            } else {
                window.open(url);
            }
        }, false);
    </script></div>