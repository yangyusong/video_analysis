
<script src='dist/echarts.js'></script>
<script src='dist/echarts-liquidfill.js'></script>
<script src="lib/jquery/jquery.js"></script>
<script src="js/underscore-min.js"></script>
<script src="js/client.js" type="text/javascript" charset="utf-8"></script>
<style>


    #main {
        padding: 20px;
    }

    #main:after {
        display: block;
        content: ' ';
        clear: both;
    }

    .chart {
        width: 25%;
        height: 150px;
        float: left;
    }
    @media (max-width: 980px) {
        .chart {
            height: 150px;
        }
    }
    @media (max-width: 750px) {
        .chart {
            width: 33.333333%;
        }
    }
    @media (max-width: 300px) {
        .chart {
            width: 50%;
            height: 150px;
        }
    }


    .main-chart {
        width: 100%;
        height: 200px;
        float: none;
        margin: -50px 0;
    }



    #view-more {
        text-align: center;
        margin: 20px 0 80px 0;
    }
</style>
<div id='main'>
    <div class="chart main-chart"></div>

</div>
<script>
    var _hmt = _hmt || [];

    var atmData = {};
    var bgColor = '#E3F7FF';
    var containers = document.getElementsByClassName('chart');
    var options = [
        {
            series: [{
                type: 'liquidFill',
                data: [0.6, 0.5, 0.4, 0.3],//注意第一个数据
                radius: '70%',
                label: {
                    formatter: '%',
                    fontSize: 25,
                    fontFamily: 'Lobster Two',
                    baseline: 'bottom',
                    position: ['50%', '86%']
                }
            }]
        }
    ];

    var charts = [];
    var chart = echarts.init(containers[0]);

    chart.setOption(options[0]);
    chart.setOption({
        baseOption: options[0],
        media: [{
            query: {
                maxWidth: 300
            },
            option: {
                series: [{
                    label: {
                        fontSize: 26
                    }
                }]
            }
        }]
    });

    charts.push(chart);

    window.onresize = function () {
        for (var i = 0; i < charts.length; ++i) {
            charts[i].resize();
        }
    };

    setInterval(update, 800);

    function update() {
        var data = [];
        var last = 1;
//        var _id = localStorage.getItem("_id");

//        if(_.size(atmData) == 0 || atmData._id != _id)
        if(true )
        {
            client.get(client.devHost + client.exist, {}, function(datas){
                console.log("atm");
                console.log(datas);
                if(_.size(datas) > 0)
                {
                    console.log("atm");
                    console.log(datas);
                    atmData = datas;
                    for (var i = 0; i < 4; ++i) {
                        last = Math.floor(datas.atm
                                        ) / 100;
                        data.push(last);
                    }
                    charts[0].setOption({
                        series: [{
                            data: data,
                            label: {
                                formatter: "" + datas.atm + '%',
                                fontSize: 25,
                                fontFamily: 'Lobster Two',
                                baseline: 'bottom',
                                position: ['50%', '86%']
                            }
                        }]
                    });
//                datas = JSON.parse(datas);
                }

            });
        }

    }
</script>
